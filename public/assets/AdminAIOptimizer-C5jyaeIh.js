import{c as B,r as k,N as se,o as ae,j as e,L as re,B as j,C as x,d as m,a as D,b as A,e as ie}from"./index-CuprRf9A.js";import{u as ne}from"./useQuery-ZJWojQjZ.js";import{u as le}from"./useMutation-BvbhO3Ww.js";import{B as v}from"./badge-gyCBv1ly.js";import{I as ce}from"./input-C7AUaPAc.js";import{S as de,a as oe,b as xe,c as me,d as h}from"./select-CtwjQDgd.js";import{T as he,a as je,b as P,c as i,d as ue,e as n}from"./table-CQCSVrtb.js";import{D as ge,a as pe,b as fe,c as Ne,d as ve,e as ye}from"./dialog-BKYCW-Wh.js";import{A as be}from"./arrow-left-C_Zpo_h0.js";import{B as T}from"./brain-PyXg_Y2k.js";import{F as $}from"./file-text-CPhKcBMc.js";import{T as we}from"./target-Daxxxr6z.js";import{C as Se}from"./chart-no-axes-column-increasing-B3AX3zXE.js";import{T as Ce}from"./trending-up-3yF84ArF.js";import{S as ke}from"./search-CZt2VAwY.js";import{F as Te}from"./filter-DZsR-ZXm.js";import{U as I}from"./user-Cl-ZMPZM.js";import{M as Ee}from"./mail-Fpe7ux_n.js";import{P as ze}from"./phone-CuS033j8.js";import{L as Fe}from"./linkedin-DWPjXw38.js";import{D as R}from"./download-yc1mZr8Q.js";import{E as De}from"./eye-CjoTDjXc.js";import{C as p}from"./clock-CaA2KRiY.js";import{T as U}from"./triangle-alert-CjSSRQIf.js";import{C as u}from"./circle-check-big-DSnttqeU.js";import"./utils-km2FGkQ4.js";import"./index-B6XFBDnY.js";import"./Combination-DKMiJ1tB.js";import"./index-DqFLgNHl.js";import"./index-CCUsGLlQ.js";import"./check-CFzykUac.js";import"./index-_bRr0aPa.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=B("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=B("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),N=s=>s.enhancedText?"completed":s.extractedText?"analyzing":"pending",L=s=>{switch(s.extractionStatus){case"processing":return{status:"Extracting contacts...",color:"text-blue-500",icon:f};case"completed":return{status:"Contact extracted",color:"text-green-500",icon:u};case"failed":return{status:"Extraction failed",color:"text-red-500",icon:U};case"pending":return{status:"Queued for extraction",color:"text-yellow-500",icon:p};default:return s.extractedText?{status:"Ready for extraction",color:"text-yellow-500",icon:p}:{status:"Awaiting text extraction",color:"text-gray-500",icon:p}}},M=s=>s||0,E=s=>s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`,q={pending:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",analyzing:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",completed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",failed:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},V={pending:p,analyzing:Ae,completed:u,failed:U},Pe=({scan:s})=>{const g=N(s);return M(s.projectedScore),e.jsxs(fe,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-primary"}),"AI CareerCatalyst Scan: ",s.filename]}),e.jsx(ye,{children:"View detailed analysis results and extracted information from this AI career optimization scan."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Scan Details"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"File:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.filename})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"File Size:"}),e.jsx("span",{className:"ml-2",children:E(s.fileSize)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Upload Date:"}),e.jsx("span",{className:"ml-2",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment Status:"}),e.jsx("span",{className:"ml-2",children:e.jsx(v,{className:s.paymentVerified?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800",children:s.paymentVerified?"Verified":"Pending"})})]}),s.projectedScore&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Projected Score:"}),e.jsxs("span",{className:"ml-2 font-medium text-primary",children:[s.projectedScore,"/100"]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Processing Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.extractedText?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:"Text Extraction"}),s.extractedText&&e.jsx(u,{className:"w-4 h-4 text-green-500"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.enhancedText?"bg-green-500":s.extractedText?"bg-yellow-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:"AI Enhancement"}),s.enhancedText&&e.jsx(u,{className:"w-4 h-4 text-green-500"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.paymentVerified?"bg-green-500":"bg-yellow-500"}`}),e.jsx("span",{className:"text-sm",children:"Payment Verification"}),s.paymentVerified&&e.jsx(u,{className:"w-4 h-4 text-green-500"})]})]})]}),s.extractedText&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Extracted Content Preview"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg max-h-40 overflow-y-auto",children:e.jsxs("pre",{className:"text-xs whitespace-pre-wrap text-muted-foreground",children:[s.extractedText.substring(0,500),s.extractedText.length>500?"...":""]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsx(v,{className:q[g],children:g.toUpperCase()})]}),s.enhancedText&&s.paymentVerified&&e.jsxs(j,{size:"sm",variant:"secondary",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Download Enhanced Resume"]})]})]})]})};function mt(){const[s,g]=k.useState(""),[y,H]=k.useState("all"),[z,b]=k.useState(null),O=se(),{toast:F}=ae(),{data:w,isLoading:Q,isError:K}=ne({queryKey:["/api/admin/optimizer-scans"],refetchInterval:5*1e3,retry:3,retryDelay:2e3}),Z=async(t,a,c)=>{const d=await fetch("/api/csrf-token",{credentials:"include"});if(!d.ok)throw new Error("Failed to get CSRF token");const{token:r}=await d.json(),o=await fetch(a,{method:t,headers:{"X-CSRF-Token":r},body:void 0,credentials:"include"});if(!o.ok){const te=await o.text();throw new Error(`${o.status}: ${te}`)}return o.json()},_=le({mutationFn:async t=>{const a=await Z("POST",`/api/admin/optimizer-scans/${t}/extract-contact`);if(!a.success)throw new Error(a.message||"Failed to extract contact information");return a},onSuccess:t=>{var a;O.invalidateQueries({queryKey:["/api/admin/optimizer-scans"]}),b(null),F({title:"Contact Information Extracted",description:`Successfully extracted contact details for ${((a=t.contactData)==null?void 0:a.name)||"candidate"}.`})},onError:t=>{console.error("Failed to extract contact:",t),b(null),F({title:"Contact Extraction Failed",description:t.message||"Failed to extract contact information. Please try again.",variant:"destructive"})}}),W=async t=>{b(t),_.mutate(t)};if(Q&&!w)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})});const l=w||[],X=K&&!w,S=l.filter(t=>{const a=!s||t.filename.toLowerCase().includes(s.toLowerCase()),c=N(t);return a&&(y==="all"||c===y)}),G=l.reduce((t,a)=>{const c=N(a);return t[c]=(t[c]||0)+1,t},{}),C=l.filter(t=>t.projectedScore&&t.projectedScore>0),J=C.length>0?C.reduce((t,a)=>t+(a.projectedScore||0),0)/C.length:0,Y=l.length>0?l.reduce((t,a)=>t+a.fileSize,0)/l.length:0,ee=l.length>0?l.filter(t=>t.paymentVerified).length/l.length*100:0;return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(re,{href:"/admin",children:e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-ink flex items-center gap-2",children:[e.jsx(T,{className:"w-8 h-8 text-primary"}),"AI CareerCatalyst"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor AI resume optimization scans and performance metrics"})]})]})}),X&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800",children:"⚠️ Unable to load optimizer scans data. Showing empty state."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(x,{className:"text-center",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx($,{className:"w-4 h-4 text-primary"}),e.jsx("div",{className:"text-2xl font-bold",children:l.length})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Scans"})]})}),e.jsx(x,{className:"text-center",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(we,{className:"w-4 h-4 text-blue-500"}),e.jsx("div",{className:"text-2xl font-bold",children:J.toFixed(0)})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Projected Score"})]})}),e.jsx(x,{className:"text-center",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Se,{className:"w-4 h-4 text-green-500"}),e.jsx("div",{className:"text-2xl font-bold",children:E(Y)})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg File Size"})]})}),e.jsx(x,{className:"text-center",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ce,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"text-2xl font-bold",children:[ee.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Payment Verified"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:Object.entries(G).map(([t,a])=>{const c=V[t];return e.jsx(x,{className:"text-center",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("div",{className:"text-2xl font-bold",children:a})]}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:t})]})},t)})}),e.jsxs(x,{className:"mb-6",children:[e.jsx(D,{children:e.jsx(A,{className:"text-lg",children:"Filters"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(ce,{placeholder:"Search by filename...",value:s,onChange:t=>g(t.target.value),className:"pl-10","data-testid":"search-scans"})]})}),e.jsxs(de,{value:y,onValueChange:H,children:[e.jsxs(oe,{className:"w-[180px]",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),e.jsx(xe,{placeholder:"Filter by status"})]}),e.jsxs(me,{children:[e.jsx(h,{value:"all",children:"All Status"}),e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"analyzing",children:"Analyzing"}),e.jsx(h,{value:"completed",children:"Completed"}),e.jsx(h,{value:"failed",children:"Failed"})]})]})]})})]}),e.jsxs(x,{children:[e.jsxs(D,{children:[e.jsxs(A,{children:["AI Optimization Scans (",S.length,")"]}),e.jsx(ie,{children:"Click on any scan to view detailed optimization report"})]}),e.jsxs(m,{className:"p-0",children:[e.jsxs(he,{children:[e.jsx(je,{children:e.jsxs(P,{children:[e.jsx(i,{children:"File"}),e.jsx(i,{children:"File Size"}),e.jsx(i,{children:"Candidate Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Phone"}),e.jsx(i,{children:"LinkedIn"}),e.jsx(i,{children:"Projected Score"}),e.jsx(i,{children:"Payment Status"}),e.jsx(i,{children:"Processing Status"}),e.jsx(i,{children:"Upload Date"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(ue,{children:S.map(t=>{const a=N(t),c=V[a],d=M(t.projectedScore);return e.jsxs(P,{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:t.filename}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.mimeType})]})]})}),e.jsx(n,{children:e.jsx("span",{className:"text-sm",children:E(t.fileSize)})}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center gap-2",children:t.candidateName?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:t.candidateName})]}):e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const r=L(t),o=r.icon;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{className:`w-3 h-3 ${r.icon===f?"animate-spin":""} ${r.color}`}),e.jsx("span",{className:`text-xs ${r.color}`,children:r.status}),t.extractionError&&e.jsx("span",{className:"text-xs text-red-500 ml-1",title:t.extractionError,children:"(Error)"})]})})()})})}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center gap-1",children:t.candidateEmails&&t.candidateEmails.length>0?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:[t.candidateEmails[0],t.candidateEmails.length>1&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(+",t.candidateEmails.length-1,")"]})]})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})})}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center gap-1",children:t.candidatePhone?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:t.candidatePhone})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})})}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center gap-1",children:t.candidateLinkedinUrl?e.jsxs("a",{href:t.candidateLinkedinUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:text-blue-800 dark:text-blue-400",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:"Profile"})]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})})}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center gap-2",children:d>0?e.jsxs("div",{className:`text-sm font-medium ${d<60?"text-red-500":d<80?"text-yellow-500":"text-green-500"}`,children:[d,"/100"]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"Not analyzed"})})}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(v,{className:t.paymentVerified?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:t.paymentVerified?"Verified":"Pending"})})}),e.jsx(n,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx(v,{className:q[a],children:a})]}),!t.candidateName&&t.extractionStatus&&e.jsx("div",{className:"text-xs flex items-center gap-1",children:(()=>{const r=L(t),o=r.icon;return e.jsxs(e.Fragment,{children:[e.jsx(o,{className:`w-3 h-3 ${r.icon===f?"animate-spin":""} ${r.color}`}),e.jsx("span",{className:r.color,children:r.status}),t.extractionError&&e.jsx("span",{className:"text-red-500 ml-1",title:t.extractionError,children:"(Error)"})]})})()})]})}),e.jsx(n,{children:e.jsx("span",{className:"text-sm",children:new Date(t.createdAt).toLocaleDateString()})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-1",children:[!t.candidateName&&(t.extractionStatus==="failed"||t.extractionStatus==="pending"||t.extractedText&&t.extractionStatus!=="processing")&&e.jsx(j,{variant:"ghost",size:"sm","data-testid":`extract-contact-${t.id}`,onClick:()=>W(t.id),disabled:z===t.id,title:t.extractionStatus==="failed"?"Retry contact extraction":"Extract contact manually",children:z===t.id?e.jsx(f,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"})}),t.enhancedText&&t.paymentVerified&&e.jsx(j,{variant:"ghost",size:"sm","data-testid":`download-scan-${t.id}`,onClick:()=>{const r=document.createElement("a");r.setAttribute("href",`/api/optimizer/download/${t.id}`),r.setAttribute("download",`${t.filename.replace(/\.[^/.]+$/,"")}_enhanced.pdf`),r.click()},children:e.jsx(R,{className:"w-4 h-4"})}),e.jsxs(ge,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm","data-testid":`view-scan-${t.id}`,children:e.jsx(De,{className:"w-4 h-4"})})}),e.jsx(Pe,{scan:t})]})]})})]},t.id)})})]}),S.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No AI optimization scans found matching your criteria"})]})]})]})]})})}export{mt as default};
