import{c as Q,w as W,r,D as X,E as $,j as e,P as q,G as V,O as Y,x as F,o as Z,L as ee,B as R,C as u,d as p,a as C,b as T,e as A}from"./index-CuprRf9A.js";import{u as se}from"./useQuery-ZJWojQjZ.js";import{u as te}from"./useMutation-BvbhO3Ww.js";import{B as I}from"./badge-gyCBv1ly.js";import{u as ae}from"./index-CCUsGLlQ.js";import{I as P}from"./input-C7AUaPAc.js";import{L as k}from"./label-BOUa42Nh.js";import{T as re,a as ie,b as U,c as g,d as ne,e as y}from"./table-CQCSVrtb.js";import{A as ce}from"./arrow-left-C_Zpo_h0.js";import{S as D}from"./shield-B5sw-Pqc.js";import{U as M}from"./users-CvrVW2dn.js";import{T as oe}from"./triangle-alert-CjSSRQIf.js";import{S as de}from"./settings-Ct9MlVja.js";import{R as le}from"./refresh-cw-pEi6f55H.js";import{C as me}from"./circle-check-big-DSnttqeU.js";import{A as xe}from"./activity-CJH3RrLQ.js";import{E as he}from"./eye-CjoTDjXc.js";import{F as B}from"./file-text-CPhKcBMc.js";import"./utils-km2FGkQ4.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=Q("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);var E="Switch",[pe,qe]=W(E),[je,fe]=pe(E),H=r.forwardRef((t,n)=>{const{__scopeSwitch:a,name:d,checked:c,defaultChecked:j,required:l,disabled:m,value:x="on",onCheckedChange:h,form:b,...f}=t,[o,L]=r.useState(null),i=X(n,S=>L(S)),v=r.useRef(!1),w=o?b||!!o.closest("form"):!0,[s=!1,N]=$({prop:c,defaultProp:j,onChange:h});return e.jsxs(je,{scope:a,checked:s,disabled:m,children:[e.jsx(q.button,{type:"button",role:"switch","aria-checked":s,"aria-required":l,"data-state":z(s),"data-disabled":m?"":void 0,disabled:m,value:x,...f,ref:i,onClick:V(t.onClick,S=>{N(J=>!J),w&&(v.current=S.isPropagationStopped(),v.current||S.stopPropagation())})}),w&&e.jsx(ge,{control:o,bubbles:!v.current,name:d,value:x,checked:s,required:l,disabled:m,form:b,style:{transform:"translateX(-100%)"}})]})});H.displayName=E;var _="SwitchThumb",O=r.forwardRef((t,n)=>{const{__scopeSwitch:a,...d}=t,c=fe(_,a);return e.jsx(q.span,{"data-state":z(c.checked),"data-disabled":c.disabled?"":void 0,...d,ref:n})});O.displayName=_;var ge=t=>{const{control:n,checked:a,bubbles:d=!0,...c}=t,j=r.useRef(null),l=ae(a),m=Y(n);return r.useEffect(()=>{const x=j.current,h=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(h,"checked").set;if(l!==a&&f){const o=new Event("click",{bubbles:d});f.call(x,a),x.dispatchEvent(o)}},[l,a,d]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...c,tabIndex:-1,ref:j,style:{...t.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function z(t){return t?"checked":"unchecked"}var K=H,ye=O;const G=r.forwardRef(({className:t,...n},a)=>e.jsx(K,{className:F("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...n,ref:a,children:e.jsx(ye,{className:F("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));G.displayName=K.displayName;function He(){const[t,n]=r.useState(30),[a,d]=r.useState(5),[c,j]=r.useState(!1),[l,m]=r.useState(90),{toast:x}=Z(),{data:h,isLoading:b,isError:f}=se({queryKey:["/api/admin/security"],refetchInterval:2*60*1e3,retry:3,retryDelay:2e3}),o=te({mutationFn:async s=>{const N=await fetch("/api/admin/security/settings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!N.ok)throw new Error("Failed to update security settings");return N.json()},onSuccess:()=>{x({title:"Settings updated",description:"Security settings have been saved successfully."})},onError:s=>{x({title:"Update failed",description:"Failed to update security settings. Please try again.",variant:"destructive"})}});if(b&&!h)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})});const i=h||{overview:{activeUsers:0,failedLoginAttempts:0,securityIncidents:0,lastPasswordUpdate:"Unknown"},sessions:[],auditLog:[],settings:{sessionTimeout:30,maxLoginAttempts:5,requireTwoFactor:!1,passwordExpiryDays:90}},v=f&&!h,w=()=>{o.mutate({sessionTimeout:t,maxLoginAttempts:a,requireTwoFactor:c,passwordExpiryDays:l})};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ee,{href:"/admin",children:e.jsxs(R,{variant:"ghost",size:"sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-ink flex items-center gap-2",children:[e.jsx(D,{className:"w-8 h-8 text-primary"}),"Security Management"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor system security, user sessions, and access controls"})]})]})}),v&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800",children:"⚠️ Unable to load security data. Showing empty state."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(u,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold",children:i.overview.activeUsers})]}),e.jsx(M,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(u,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed Login Attempts"}),e.jsx("p",{className:"text-2xl font-bold",children:i.overview.failedLoginAttempts})]}),e.jsx(oe,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(u,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Security Incidents"}),e.jsx("p",{className:"text-2xl font-bold",children:i.overview.securityIncidents})]}),e.jsx(D,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(u,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Password Update"}),e.jsx("p",{className:"text-sm font-medium",children:i.overview.lastPasswordUpdate})]}),e.jsx(ue,{className:"w-8 h-8 text-primary"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(u,{children:[e.jsxs(C,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Security Settings"]}),e.jsx(A,{children:"Configure system security parameters"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"session-timeout",children:"Session Timeout (minutes)"}),e.jsx(P,{id:"session-timeout",type:"number",value:t,onChange:s=>n(parseInt(s.target.value)),min:"5",max:"480"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"max-login-attempts",children:"Max Login Attempts"}),e.jsx(P,{id:"max-login-attempts",type:"number",value:a,onChange:s=>d(parseInt(s.target.value)),min:"3",max:"10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"password-expiry",children:"Password Expiry (days)"}),e.jsx(P,{id:"password-expiry",type:"number",value:l,onChange:s=>m(parseInt(s.target.value)),min:"30",max:"365"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(k,{htmlFor:"two-factor",children:"Require Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enforce 2FA for all admin users"})]}),e.jsx(G,{id:"two-factor",checked:c,onCheckedChange:j})]}),e.jsx(R,{onClick:w,disabled:o.isPending,className:"w-full",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Save Settings"]})})]})]}),e.jsxs(u,{children:[e.jsxs(C,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Active Sessions"]}),e.jsx(A,{children:"Monitor current user sessions"})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-3",children:i.sessions.length>0?i.sessions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.user}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.ipAddress})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(I,{className:s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.status}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.lastActivity})]})]},s.id)):e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(M,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No active sessions"})]})})})]})]}),e.jsxs(u,{children:[e.jsxs(C,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"Security Audit Log"]}),e.jsx(A,{children:"Recent security-related activities and access attempts"})]}),e.jsxs(p,{className:"p-0",children:[e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(U,{children:[e.jsx(g,{children:"User"}),e.jsx(g,{children:"Action"}),e.jsx(g,{children:"Resource"}),e.jsx(g,{children:"IP Address"}),e.jsx(g,{children:"Result"}),e.jsx(g,{children:"Timestamp"})]})}),e.jsx(ne,{children:i.auditLog.map(s=>e.jsxs(U,{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(y,{children:e.jsx("span",{className:"font-medium",children:s.user})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm",children:s.action})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm",children:s.resource})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm font-mono",children:s.ipAddress})}),e.jsx(y,{children:e.jsx(I,{className:s.result==="success"?"bg-green-100 text-green-800":s.result==="failed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:s.result})}),e.jsx(y,{children:e.jsx("span",{className:"text-sm",children:s.timestamp})})]},s.id))})]}),i.auditLog.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(B,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No audit log entries found"})]})]})]})]})})}export{He as default};
