import{r as j,j as e,L as B,B as d,C as h,d as u,a as T,b as S,e as P,o as z,p as R,K as U}from"./index-CuprRf9A.js";import{u as E}from"./useQuery-ZJWojQjZ.js";import{u as H}from"./useMutation-BvbhO3Ww.js";import{B as o}from"./badge-gyCBv1ly.js";import{I as V}from"./input-C7AUaPAc.js";import{S as y,a as v,b,c as C,d as l}from"./select-CtwjQDgd.js";import{T as Q,a as K,b as q,c as i,d as G,e as n}from"./table-CQCSVrtb.js";import{D as O,a as W,b as J,c as X,d as Y}from"./dialog-BKYCW-Wh.js";import{T as Z}from"./textarea-CM19OCj5.js";import{A as _}from"./arrow-left-C_Zpo_h0.js";import{M as p}from"./mail-Fpe7ux_n.js";import{C as ee}from"./clock-CaA2KRiY.js";import{M as se}from"./message-square-DFJFvJ6H.js";import{C as k}from"./circle-check-big-DSnttqeU.js";import{S as ae}from"./search-CZt2VAwY.js";import{F as D}from"./filter-DZsR-ZXm.js";import{E as re}from"./ellipsis-C0qTVLNY.js";import{U as le}from"./user-Cl-ZMPZM.js";import{P as A}from"./phone-CuS033j8.js";import{B as te}from"./building-C1dFx26k.js";import{S as ie}from"./star-P3qg4A1_.js";import"./utils-km2FGkQ4.js";import"./index-B6XFBDnY.js";import"./Combination-DKMiJ1tB.js";import"./index-DqFLgNHl.js";import"./index-CCUsGLlQ.js";import"./check-CFzykUac.js";import"./index-_bRr0aPa.js";const F={new:"bg-blue-100 text-blue-800",contacted:"bg-yellow-100 text-yellow-800",qualified:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"},L={"contract-staffing":"bg-purple-100 text-purple-800","permanent-placement":"bg-orange-100 text-orange-800","career-advisory":"bg-green-100 text-green-800",consulting:"bg-blue-100 text-blue-800",general:"bg-gray-100 text-gray-800"},ne=({contact:a})=>{const{toast:m}=z(),[x,g]=j.useState(a.notes||""),c=H({mutationFn:async r=>(await R("PATCH",`/api/admin/contacts/${a.id}`,r)).json(),onSuccess:()=>{U.invalidateQueries({queryKey:["/api/admin/contacts"]}),m({title:"Contact Updated",description:"Status updated successfully"})},onError:r=>{m({title:"Update Failed",description:r.message||"Failed to update contact",variant:"destructive"})}}),f=r=>{c.mutate({status:r})};return e.jsxs(J,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsx(X,{children:e.jsxs(Y,{children:["Contact: ",a.firstName," ",a.lastName]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium",children:[a.firstName," ",a.lastName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`mailto:${a.email}`,className:"text-sm text-primary hover:underline",children:a.email})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("a",{href:`tel:${a.phone}`,className:"text-sm text-primary hover:underline",children:a.phone})]}),a.company&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.company})]}),a.jobTitle&&e.jsx("div",{className:"text-sm text-muted-foreground ml-6",children:a.jobTitle})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-3",children:"Inquiry Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Type:"}),e.jsx(o,{className:`ml-2 ${L[a.inquiryType]}`,children:a.inquiryType.replace("-"," ").replace(/\b\w/g,r=>r.toUpperCase())})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Preferred Contact:"}),e.jsx("span",{className:"ml-2 text-sm capitalize",children:a.preferredContact||"Any"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Received:"}),e.jsx("span",{className:"ml-2 text-sm",children:new Date(a.createdAt).toLocaleString()})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Subject"}),e.jsx("p",{className:"text-sm bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:a.subject})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Message"}),e.jsx("div",{className:"text-sm bg-gray-50 dark:bg-gray-800 p-4 rounded-lg whitespace-pre-wrap max-h-40 overflow-y-auto",children:a.message})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Status Management"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Current Status:"}),e.jsx(o,{className:F[a.status],children:a.status})]}),e.jsxs(y,{onValueChange:f,defaultValue:a.status,children:[e.jsx(v,{className:"w-40",children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"new",children:"New"}),e.jsx(l,{value:"contacted",children:"Contacted"}),e.jsx(l,{value:"qualified",children:"Qualified"}),e.jsx(l,{value:"closed",children:"Closed"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Internal Notes"}),e.jsx(Z,{placeholder:"Add internal notes about this contact...",value:x,onChange:r=>g(r.target.value),className:"min-h-[100px]"}),e.jsx(d,{size:"sm",className:"mt-2",onClick:()=>{m({title:"Notes Saved",description:"Contact notes updated successfully"})},children:"Save Notes"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t",children:[e.jsx(d,{size:"sm",variant:"secondary",asChild:!0,children:e.jsxs("a",{href:`mailto:${a.email}?subject=Re: ${a.subject}`,children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Reply via Email"]})}),a.phone&&e.jsx(d,{size:"sm",variant:"secondary",asChild:!0,children:e.jsxs("a",{href:`tel:${a.phone}`,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Call"]})}),e.jsxs(d,{size:"sm",variant:"secondary",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Mark as Priority"]})]})]})]})};function Be(){const[a,m]=j.useState(""),[x,g]=j.useState("all"),[c,f]=j.useState("all"),{data:r,isLoading:w}=E({queryKey:["/api/admin/contacts"],refetchInterval:5*60*1e3}),N=(r==null?void 0:r.filter(s=>{const t=!a||`${s.firstName} ${s.lastName}`.toLowerCase().includes(a.toLowerCase())||s.email.toLowerCase().includes(a.toLowerCase())||s.subject.toLowerCase().includes(a.toLowerCase()),$=x==="all"||s.status===x,I=c==="all"||s.inquiryType===c;return t&&$&&I}))||[],M=(r==null?void 0:r.reduce((s,t)=>(s[t.status]=(s[t.status]||0)+1,s),{}))||{};return r!=null&&r.reduce((s,t)=>(s[t.inquiryType]=(s[t.inquiryType]||0)+1,s),{}),w?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{href:"/admin",children:e.jsxs(d,{variant:"ghost",size:"sm",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-ink flex items-center gap-2",children:[e.jsx(p,{className:"w-8 h-8 text-primary"}),"Contact Inquiries"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and respond to client inquiries and business leads"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(h,{className:"text-center",children:e.jsxs(u,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.length)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Contacts"})]})}),Object.entries(M).map(([s,t])=>e.jsx(h,{className:"text-center",children:e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[s==="new"&&e.jsx(ee,{className:"w-4 h-4 text-blue-500"}),s==="contacted"&&e.jsx(se,{className:"w-4 h-4 text-yellow-500"}),s==="qualified"&&e.jsx(k,{className:"w-4 h-4 text-green-500"}),s==="closed"&&e.jsx(k,{className:"w-4 h-4 text-gray-500"}),e.jsx("div",{className:"text-2xl font-bold",children:t})]}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:s})]})},s))]}),e.jsxs(h,{className:"mb-6",children:[e.jsx(T,{children:e.jsx(S,{className:"text-lg",children:"Filters"})}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(V,{placeholder:"Search by name, email, or subject...",value:a,onChange:s=>m(s.target.value),className:"pl-10","data-testid":"search-contacts"})]})}),e.jsxs(y,{value:x,onValueChange:g,children:[e.jsxs(v,{className:"w-[180px]",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),e.jsx(b,{placeholder:"Filter by status"})]}),e.jsxs(C,{children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"new",children:"New"}),e.jsx(l,{value:"contacted",children:"Contacted"}),e.jsx(l,{value:"qualified",children:"Qualified"}),e.jsx(l,{value:"closed",children:"Closed"})]})]}),e.jsxs(y,{value:c,onValueChange:f,children:[e.jsxs(v,{className:"w-[200px]",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),e.jsx(b,{placeholder:"Filter by type"})]}),e.jsxs(C,{children:[e.jsx(l,{value:"all",children:"All Types"}),e.jsx(l,{value:"contract-staffing",children:"Contract Staffing"}),e.jsx(l,{value:"permanent-placement",children:"Permanent Placement"}),e.jsx(l,{value:"career-advisory",children:"Career Advisory"}),e.jsx(l,{value:"consulting",children:"Consulting"}),e.jsx(l,{value:"general",children:"General"})]})]})]})})]}),e.jsxs(h,{children:[e.jsxs(T,{children:[e.jsxs(S,{children:["Contact Inquiries (",N.length,")"]}),e.jsx(P,{children:"Click on any contact to view details and manage status"})]}),e.jsxs(u,{className:"p-0",children:[e.jsxs(Q,{children:[e.jsx(K,{children:e.jsxs(q,{children:[e.jsx(i,{children:"Contact"}),e.jsx(i,{children:"Phone"}),e.jsx(i,{children:"Company"}),e.jsx(i,{children:"Inquiry Type"}),e.jsx(i,{children:"Priority"}),e.jsx(i,{children:"Subject"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Source"}),e.jsx(i,{children:"Follow-up"}),e.jsx(i,{children:"Received"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(G,{children:N.map(s=>e.jsxs(q,{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(n,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]})}),e.jsx(n,{children:e.jsx("div",{className:"text-sm",children:s.phone?e.jsx("a",{href:`tel:${s.phone}`,className:"text-primary hover:underline",children:s.phone}):e.jsx("span",{className:"text-muted-foreground",children:"No phone"})})}),e.jsx(n,{children:e.jsxs("div",{children:[s.company&&e.jsx("div",{className:"text-sm font-medium",children:s.company}),s.jobTitle&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.jobTitle})]})}),e.jsx(n,{children:e.jsx(o,{className:L[s.inquiryType],children:s.inquiryType.replace("-"," ").replace(/\b\w/g,t=>t.toUpperCase())})}),e.jsx(n,{children:e.jsx(o,{className:s.inquiryType==="permanent-placement"?"bg-red-100 text-red-700":s.inquiryType==="contract-staffing"?"bg-orange-100 text-orange-700":s.inquiryType==="career-advisory"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700",children:s.inquiryType==="permanent-placement"?"High":s.inquiryType==="contract-staffing"?"Medium":s.inquiryType==="career-advisory"?"Revenue":"Low"})}),e.jsx(n,{children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:s.subject}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.message})]})}),e.jsx(n,{children:e.jsx(o,{className:F[s.status],children:s.status})}),e.jsx(n,{children:e.jsx("div",{className:"text-sm",children:s.preferredContact?s.preferredContact.charAt(0).toUpperCase()+s.preferredContact.slice(1):"Website"})}),e.jsx(n,{children:e.jsx("div",{className:"text-sm",children:s.status==="new"?e.jsx("span",{className:"text-amber-600 font-medium",children:"Today"}):s.status==="contacted"?e.jsx("span",{className:"text-blue-600",children:"3 days"}):s.status==="qualified"?e.jsx("span",{className:"text-green-600",children:"1 week"}):e.jsx("span",{className:"text-muted-foreground",children:"â€”"})})}),e.jsx(n,{children:e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString()})}),e.jsx(n,{className:"text-right",children:e.jsxs(O,{children:[e.jsx(W,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"sm","data-testid":`view-contact-${s.id}`,children:e.jsx(re,{className:"w-4 h-4"})})}),e.jsx(ne,{contact:s})]})})]},s.id))})]}),N.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No contacts found matching your criteria"})]})]})]})]})})}export{Be as default};
