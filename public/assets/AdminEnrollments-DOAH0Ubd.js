import{r as g,j as e,L as I,B as f,C as m,d as x,a as N,b as v,e as k,o as L,p as $,K as B}from"./index-CuprRf9A.js";import{u as M}from"./useQuery-ZJWojQjZ.js";import{u as U}from"./useMutation-BvbhO3Ww.js";import{B as S}from"./badge-gyCBv1ly.js";import{I as H}from"./input-C7AUaPAc.js";import{S as D,a as T,b as A,c as P,d as r}from"./select-CtwjQDgd.js";import{T as V,a as q,b,c as l,d as z,e as d}from"./table-CQCSVrtb.js";import{D as K,a as R,b as Q,c as O,d as G,e as J}from"./dialog-BKYCW-Wh.js";import{A as W}from"./arrow-left-C_Zpo_h0.js";import{U as y}from"./users-CvrVW2dn.js";import{S as X}from"./search-CZt2VAwY.js";import{F as Y}from"./filter-DZsR-ZXm.js";import{E as Z}from"./ellipsis-C0qTVLNY.js";import{C as _}from"./clock-CaA2KRiY.js";import{C as j}from"./circle-check-big-DSnttqeU.js";import{T as ee}from"./triangle-alert-CjSSRQIf.js";import{M as se}from"./mail-Fpe7ux_n.js";import{P as ae}from"./phone-CuS033j8.js";import{D as te}from"./dollar-sign-CKcXNn6o.js";import{C}from"./calendar-BnnWEMnC.js";import"./utils-km2FGkQ4.js";import"./index-B6XFBDnY.js";import"./Combination-DKMiJ1tB.js";import"./index-DqFLgNHl.js";import"./index-CCUsGLlQ.js";import"./check-CFzykUac.js";import"./index-_bRr0aPa.js";const E={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",active:"bg-green-100 text-green-800",completed:"bg-purple-100 text-purple-800",cancelled:"bg-red-100 text-red-800"},w={pending:_,confirmed:j,active:j,completed:j,cancelled:ee},re=({enrollment:a})=>{const{toast:n}=L(),c=U({mutationFn:async t=>(await $("PATCH",`/api/admin/enrollments/${a.id}`,t)).json(),onSuccess:()=>{B.invalidateQueries({queryKey:["/api/admin/enrollments"]}),n({title:"Enrollment Updated",description:"Status updated successfully"})},onError:t=>{n({title:"Update Failed",description:t.message||"Failed to update enrollment",variant:"destructive"})}}),o=t=>{c.mutate({status:t})};return e.jsxs(Q,{className:"max-w-2xl",children:[e.jsxs(O,{children:[e.jsxs(G,{children:[a.firstName," ",a.lastName]}),e.jsx(J,{children:"View and manage enrollment details, status, and payment information."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Contact Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.email})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:a.phone})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Payment Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["$",a.paidAmount," / $",a.totalAmount]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Plan: ",a.planId==="full"?"Pay in Full":"Split Payment"," | Success Fee: ",a.successFee,"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Status Management"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Current Status:"}),e.jsx(S,{className:E[a.status],children:a.status})]}),e.jsxs(D,{onValueChange:o,defaultValue:a.status,children:[e.jsx(T,{className:"w-40",children:e.jsx(A,{})}),e.jsxs(P,{children:[e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"confirmed",children:"Confirmed"}),e.jsx(r,{value:"active",children:"Active"}),e.jsx(r,{value:"completed",children:"Completed"}),e.jsx(r,{value:"cancelled",children:"Cancelled"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Timeline"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:["Enrolled: ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{children:["Last Updated: ",new Date(a.updatedAt).toLocaleDateString()]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Payment Information"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["Payment Intent: ",e.jsx("code",{className:"text-xs bg-gray-200 dark:bg-gray-700 px-1 rounded",children:a.stripePaymentIntentId})]}),e.jsxs("div",{children:["Payment Type: ",a.paymentType]})]})})]})]})]})};function Ie(){const[a,n]=g.useState(""),[c,o]=g.useState("all"),{data:t,isLoading:p}=M({queryKey:["/api/admin/enrollments"],refetchInterval:5*60*1e3}),h=(t==null?void 0:t.filter(s=>{const i=!a||`${s.firstName} ${s.lastName}`.toLowerCase().includes(a.toLowerCase())||s.email.toLowerCase().includes(a.toLowerCase()),u=c==="all"||s.status===c;return i&&u}))||[],F=(t==null?void 0:t.reduce((s,i)=>(s[i.status]=(s[i.status]||0)+1,s),{}))||{};return p?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{href:"/admin",children:e.jsxs(f,{variant:"ghost",size:"sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-ink flex items-center gap-2",children:[e.jsx(y,{className:"w-8 h-8 text-primary"}),"Career Advisory Enrollments"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage and track all Career Advisory program participants"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(m,{className:"text-center",children:e.jsxs(x,{className:"p-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:(t==null?void 0:t.length)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total"})]})}),Object.entries(F).map(([s,i])=>{const u=w[s];return e.jsx(m,{className:"text-center",children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("div",{className:"text-2xl font-bold",children:i})]}),e.jsx("div",{className:"text-xs text-muted-foreground capitalize",children:s})]})},s)})]}),e.jsxs(m,{className:"mb-6",children:[e.jsx(N,{children:e.jsx(v,{className:"text-lg",children:"Filters"})}),e.jsx(x,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(H,{placeholder:"Search by name or email...",value:a,onChange:s=>n(s.target.value),className:"pl-10","data-testid":"search-enrollments"})]})}),e.jsxs(D,{value:c,onValueChange:o,children:[e.jsxs(T,{className:"w-[180px]",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),e.jsx(A,{placeholder:"Filter by status"})]}),e.jsxs(P,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"confirmed",children:"Confirmed"}),e.jsx(r,{value:"active",children:"Active"}),e.jsx(r,{value:"completed",children:"Completed"}),e.jsx(r,{value:"cancelled",children:"Cancelled"})]})]})]})})]}),e.jsxs(m,{children:[e.jsxs(N,{children:[e.jsxs(v,{children:["Enrollments (",h.length,")"]}),e.jsx(k,{children:"Click on any enrollment to view details and manage status"})]}),e.jsxs(x,{className:"p-0",children:[e.jsxs(V,{children:[e.jsx(q,{children:e.jsxs(b,{children:[e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Plan"}),e.jsx(l,{children:"Payment"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Enrolled"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(z,{children:h.map(s=>{const i=w[s.status];return e.jsxs(b,{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName]}),s.phone&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.phone})]})}),e.jsx(d,{children:e.jsx("span",{className:"text-sm",children:s.email})}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.planId==="full"?"Pay in Full":"Split Payment"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Success Fee: ",s.successFee,"%"]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["$",s.paidAmount]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["of $",s.totalAmount]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx(S,{className:E[s.status],children:s.status})]})}),e.jsx(d,{children:e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString()})}),e.jsx(d,{className:"text-right",children:e.jsxs(K,{children:[e.jsx(R,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm","data-testid":`view-enrollment-${s.id}`,children:e.jsx(Z,{className:"w-4 h-4"})})}),e.jsx(re,{enrollment:s})]})})]},s.id)})})]}),h.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No enrollments found matching your criteria"})]})]})]})]})})}export{Ie as default};
