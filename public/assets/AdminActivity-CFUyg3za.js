import{c as F,r as p,j as e,C as b,a as D,b as L,v as P,d as f,L as G,B as C,m as E}from"./index-CuprRf9A.js";import{u as H}from"./useQuery-ZJWojQjZ.js";import{B as g}from"./badge-gyCBv1ly.js";import{I as J}from"./input-C7AUaPAc.js";import{S as k,a as w,b as v,c as A,d as m,C as R,e as K}from"./select-CtwjQDgd.js";import{S as Q}from"./separator-9ks0_PF4.js";import{A as $}from"./arrow-left-C_Zpo_h0.js";import{A as S}from"./activity-CJH3RrLQ.js";import{S as W}from"./search-CZt2VAwY.js";import{F as X}from"./filter-DZsR-ZXm.js";import{F as B}from"./file-text-CPhKcBMc.js";import{C as Y}from"./clock-CaA2KRiY.js";import{G as Z}from"./globe-DKnZLQqU.js";import{M as ee}from"./mail-Fpe7ux_n.js";import{U as se}from"./users-CvrVW2dn.js";import{B as te}from"./briefcase-DGZYI2xj.js";import{B as ae}from"./brain-PyXg_Y2k.js";import{U as T}from"./user-Cl-ZMPZM.js";import{P as re,S as ne}from"./square-pen-CAlKgYSP.js";import{C as le}from"./circle-check-big-DSnttqeU.js";import{D as de}from"./download-yc1mZr8Q.js";import{E as ce}from"./eye-CjoTDjXc.js";import"./utils-km2FGkQ4.js";import"./index-B6XFBDnY.js";import"./Combination-DKMiJ1tB.js";import"./index-DqFLgNHl.js";import"./index-CCUsGLlQ.js";import"./check-CFzykUac.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=F("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=F("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),me={contact:ee,enrollment:se,job:te,optimizer_scan:ae,job_application:B,user:T,system:ie},xe={contact:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",enrollment:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",job:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",optimizer_scan:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",job_application:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-300",user:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300",system:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"},he={created:re,updated:ne,status_changed:le,downloaded:de,viewed:ce,deleted:oe,login:T,logout:T},pe={created:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",updated:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",status_changed:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",downloaded:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",viewed:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",deleted:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",login:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900 dark:text-emerald-300",logout:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300"},ge=({activity:t,expanded:x,onToggle:d})=>{const u=me[t.entityType]||B,c=he[t.action]||S,j=l=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(l)),i=(l,h)=>typeof l=="string"&&typeof h=="string"?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-red-600 dark:text-red-400",children:"FROM:"}),e.jsx("code",{className:"text-xs bg-red-50 dark:bg-red-900/20 px-2 py-1 rounded",children:l})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400",children:"TO:"}),e.jsx("code",{className:"text-xs bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded",children:h})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-red-600 dark:text-red-400",children:"Previous:"}),e.jsx("pre",{className:"text-xs bg-red-50 dark:bg-red-900/20 p-2 rounded mt-1 overflow-auto",children:JSON.stringify(l,null,2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-green-600 dark:text-green-400",children:"Current:"}),e.jsx("pre",{className:"text-xs bg-green-50 dark:bg-green-900/20 p-2 rounded mt-1 overflow-auto",children:JSON.stringify(h,null,2)})]})]});return e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsxs(f,{className:"p-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(c,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(g,{className:xe[t.entityType]||"bg-gray-100 text-gray-800",children:t.entityType.replace("_"," ")}),e.jsx(g,{className:pe[t.action]||"bg-gray-100 text-gray-800",children:t.action.replace("_"," ")}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",t.actor]})]}),e.jsx("p",{className:"text-sm text-foreground mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsx("span",{children:j(t.createdAt)})]}),t.metadata.ipAddress&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{children:t.metadata.ipAddress})]})]}),(t.metadata.oldValue||t.metadata.newValue||t.metadata.userAgent||t.metadata.details)&&e.jsxs(C,{variant:"ghost",size:"sm",onClick:d,className:"h-6 px-2","data-testid":`button-toggle-details-${t.id}`,children:[e.jsx("span",{className:"text-xs mr-1",children:"Details"}),x?e.jsx(R,{className:"w-3 h-3"}):e.jsx(K,{className:"w-3 h-3"})]})]})]})]})}),x&&e.jsx(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 pt-4 border-t border-border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Entity Details"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",t.entityId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",t.entityType]})]})]}),(t.metadata.oldValue||t.metadata.newValue)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Changes"}),i(t.metadata.oldValue,t.metadata.newValue)]}),t.metadata.details&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Additional Details"}),e.jsx("p",{className:"text-xs bg-muted p-2 rounded",children:t.metadata.details})]}),t.metadata.userAgent&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"User Agent"}),e.jsx("code",{className:"text-xs bg-muted p-2 rounded block overflow-auto",children:t.metadata.userAgent})]})]})})]})})};function He(){const[t,x]=p.useState(""),[d,u]=p.useState("all"),[c,j]=p.useState("all"),[i,l]=p.useState("all"),[h,I]=p.useState(new Set),{data:r,isLoading:_,error:U}=H({queryKey:["/api/admin/activity-logs",{search:t,entityType:d,action:c,actor:i}],refetchInterval:5e3}),V=s=>{I(n=>{const a=new Set(n);return a.has(s)?a.delete(s):a.add(s),a})},o=r==null?void 0:r.filter(s=>{const n=!t||s.description.toLowerCase().includes(t.toLowerCase())||s.actor.toLowerCase().includes(t.toLowerCase())||s.entityType.toLowerCase().includes(t.toLowerCase())||s.action.toLowerCase().includes(t.toLowerCase()),a=d==="all"||s.entityType===d,N=c==="all"||s.action===c,O=i==="all"||s.actor===i;return n&&a&&N&&O}),y=o==null?void 0:o.reduce((s,n)=>{const a=new Date(n.createdAt).toDateString();return s[a]||(s[a]=[]),s[a].push(n),s},{}),q=Array.from(new Set((r==null?void 0:r.map(s=>s.entityType))||[])),M=Array.from(new Set((r==null?void 0:r.map(s=>s.action))||[])),z=Array.from(new Set((r==null?void 0:r.map(s=>s.actor))||[]));return _?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):U?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs(b,{className:"w-full max-w-md",children:[e.jsx(D,{children:e.jsxs(L,{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{children:"Error Loading Activity"})]})}),e.jsx(f,{children:e.jsx("p",{className:"text-muted-foreground",children:"Unable to load activity logs. Please try again later."})})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"border-b border-border bg-card",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(G,{href:"/admin",children:e.jsxs(C,{variant:"ghost",size:"sm","data-testid":"button-back",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Activity Logs"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor all admin activities and system events in real-time"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"secondary",className:"text-xs",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Live Updates"]}),e.jsxs(g,{variant:"secondary",className:"text-xs",children:[(o==null?void 0:o.length)||0," Activities"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[e.jsxs(b,{className:"mb-6",children:[e.jsx(D,{children:e.jsx(L,{className:"text-lg",children:"Filters & Search"})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Search activities...",value:t,onChange:s=>x(s.target.value),className:"pl-10","data-testid":"input-search"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Entity Type"}),e.jsxs(k,{value:d,onValueChange:u,children:[e.jsx(w,{"data-testid":"select-entity-type",children:e.jsx(v,{placeholder:"All types"})}),e.jsxs(A,{children:[e.jsx(m,{value:"all",children:"All Types"}),q.map(s=>e.jsx(m,{value:s,children:s.replace("_"," ")},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Action"}),e.jsxs(k,{value:c,onValueChange:j,children:[e.jsx(w,{"data-testid":"select-action",children:e.jsx(v,{placeholder:"All actions"})}),e.jsxs(A,{children:[e.jsx(m,{value:"all",children:"All Actions"}),M.map(s=>e.jsx(m,{value:s,children:s.replace("_"," ")},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Actor"}),e.jsxs(k,{value:i,onValueChange:l,children:[e.jsx(w,{"data-testid":"select-actor",children:e.jsx(v,{placeholder:"All actors"})}),e.jsxs(A,{children:[e.jsx(m,{value:"all",children:"All Actors"}),z.map(s=>e.jsx(m,{value:s,children:s},s))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(C,{variant:"secondary",onClick:()=>{x(""),u("all"),j("all"),l("all")},className:"w-full","data-testid":"button-clear-filters",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Clear Filters"]})})]})})]}),e.jsx("div",{className:"space-y-6",children:y&&Object.keys(y).length>0?Object.entries(y).sort(([s],[n])=>new Date(n).getTime()-new Date(s).getTime()).map(([s,n])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:s}),e.jsx(Q,{className:"flex-1"}),e.jsxs(g,{variant:"secondary",className:"text-xs",children:[n.length," activities"]})]}),e.jsx("div",{className:"space-y-3",children:n.sort((a,N)=>new Date(N.createdAt).getTime()-new Date(a.createdAt).getTime()).map(a=>e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:e.jsx(ge,{activity:a,expanded:h.has(a.id),onToggle:()=>V(a.id)})},a.id))})]},s)):e.jsx(b,{children:e.jsxs(f,{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No Activity Found"}),e.jsx("p",{className:"text-muted-foreground",children:(r==null?void 0:r.length)===0?"No activity logs have been recorded yet.":"No activities match your current filters."})]})})})]})]})}export{He as default};
